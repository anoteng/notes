<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Notes – Registrering</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/notes/css/styles.css">
</head>
<body>
  <div class="container">
    <h1>Registrer ny veileder</h1>

    <section class="card">
      <form id="register-form">
        <label for="name">Navn:</label>
        <input type="text" id="name" name="name" required>

        <label for="email">E-post:</label>
        <input type="email" id="email" name="email" required>

        <button type="submit">Registrer</button>
      </form>
      <p id="register-message" class="message"></p>
    </section>

    <p class="small">
      Allerede bruker? <a href="/notes/login.html">Logg inn</a>
    </p>
  </div>

  <script>
    const API_BASE = "/notes/api";

    document.getElementById("register-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const msg = document.getElementById("register-message");
      msg.textContent = "";

      try {
        const resp = await fetch(`${API_BASE}/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email })
        });

        const data = await resp.json().catch(() => ({}));

        if (!resp.ok) {
          msg.textContent = data.detail || "Registrering feilet.";
          msg.classList.add("error");
          return;
        }

        // Her kan du f.eks. vise nøkkelen direkte (om API returnerer det),
        // eller bare si at de får e-post.
        if (data.api_key) {
          msg.innerHTML = `
            Bruker opprettet.<br>
            Din innloggingsnøkkel er:<br>
            <code>${data.api_key}</code><br>
            <small>Lagre denne – du trenger den for å logge inn.</small>
          `;
        } else {
          msg.textContent = "Bruker opprettet. Du får en e-post med videre instruksjoner.";
        }

        msg.classList.remove("error");
        msg.classList.add("success");
      } catch (err) {
        console.error(err);
        msg.textContent = "Klarte ikke å kontakte tjeneren.";
        msg.classList.add("error");
      }
    });
  </script>
</body>
</html>
